<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <link rel="stylesheet" type="text/css" href="meyer.css">
    <link rel="stylesheet" type="text/css" href="twittler.css">
  </head>
  <body>
    <div id="page_container">

      <!-- Start Top Deck -->
      <div id="top_deck">

        <div id="home_deck">
          <h1 class="home"><a href="">Twittler</a></h1>
        </div>
        <div id="compose_button">
          <h1 ></h1>
          <img id="new_tweet" src="twittercompose_tiny.png">
        </div>

        <div id="compose_deck">
          <div id="dinosaur"><img src="dino_shrunk.png"></div>
          <div id="compose_area">
            <h1>compose new tweet</h1>
            <input id="input_username" placeholder=" Username"> </input>
            <p><textarea id="input_message" placeholder=" Tweet or ROAR!!!"></textarea></p>
            <button class="send_button"> Send</button>
          </div>
        </div>

      </div>
      
      <!-- Start Content -->
      <div id="content_container">
        <div id="content_left">
          Put filler here at some point.
        </div>

        <div id="content_right">
          <div id="updates">
            <h2 id="user_title">Tweets from: all</h2>
          <button id="tweet_alerts">Up to date</button>
          </div>

          <div id="tweet_box">
            <!-- <div class="tweet_card">
              <div class="card_username">Username</div>
              <div class="card_date">Date</div>
              <div class="card_message" rows="4" columns="12">Message</div>
            </div> -->
          </div>
        </div> <!-- end content_right -->
      </div>

    </div>

    <script type="text/javascript">
      $('#compose_deck').hide()
      $('#compose_button').on('click', '#new_tweet', function(){
        $('#compose_deck').slideToggle()
      })

    </script>

    <script>

      $(document).ready(function(){
        var $box = $('#tweet_box');
        $box.html('');

        var index = 0;

        var showNewTweets = function() {
          for (var i = index; i < streams.home.length; i++) {
            console.log("adding streams.home at index: " + index)
            var tweet = streams.home[index];
            var $tweet = $('<div class="tweet_card"></div>');
            $tweet.append(
              '<div class="card_username"><a href="" class="user_link">@' + tweet.user + '</a></div>' +
              '<div class="card_date">'+ tweet.created_at + '</div>' +
              '<div class="card_message">' + tweet.message +'<div>');
            $tweet.prependTo($box);
            index += 1;
          };  
        };
        
        var showUserTweets = function(username) {
          var user_index = 0
          for (var i = 0; i < streams.users[username].length; i++) {
            console.log("adding streams.users for: " + username)
            var tweet = streams.users[username][i];
            var $tweet = $('<div class="tweet_card"></div>');
            $tweet.append(
              '<div class="card_username"><a href="" class="user_link">@' + tweet.user + '</a></div>' +
              '<div class="card_date">'+ tweet.created_at + '</div>' +
              '<div class="card_message">' + tweet.message +'<div>');
            $tweet.prependTo($box);
            user_index += 1;
          };
        };

        var checkNewTweets = function() {
          var diff = streams.home.length - (index+1);
          if (diff === 1) {
            $('#tweet_alerts').text(diff + " new tweet");  
          };
          if (diff > 1) {
            $('#tweet_alerts').text(diff + " new tweets");  
          };
          return diff 
        };

        // Show initial tweets
          showNewTweets();

        // Periodically check for new tweets 
        // Could instead call checkNewTweets in data_generator.js
        var checkAll = setInterval(checkNewTweets, 750);

        $('#tweet_alerts').on('click', function(event){
          event.preventDefault();
          $('#tweet_alerts').text("Up to date")  
          showNewTweets();
        });

        $('#tweet_box').on('click', '.user_link' ,function(event){
          event.preventDefault();
          var username = $(this).text().slice(1)
          $box.html('');
          $("#tweet_alerts").hide()
          $("#user_title").html("Tweets from: " + 
            '<a href="" id="back" >all</a> > ' + username)
          showUserTweets(username);
        });

        $('body').on('click', '.home a' ,function(event){
          event.preventDefault();
          $("#tweet_alerts").show()
          $box.html('');
          //$("#user_title").text("")

          index = 0; 
          $('#tweet_alerts').trigger('click')
        });

      });

    </script>

  </body>
</html>
